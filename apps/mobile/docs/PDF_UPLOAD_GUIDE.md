# PDF Upload Guide for RAG System

## Overview
This guide provides step-by-step instructions for adding PDF documents to the CoachMeld RAG (Retrieval-Augmented Generation) system.

## Prerequisites
- [ ] Access to Supabase dashboard
- [ ] PDF document(s) ready to upload
- [ ] OpenAI API key (for embeddings - future step)

## Method 1: Manual Upload (Quick Start)

### Step 1: Access Supabase SQL Editor
1. Go to: https://supabase.com/dashboard/project/ndthcblvtvquiaaekwpe/sql
2. Click "SQL Editor" in the left sidebar

### Step 2: Create Document Source
Run this SQL query (replace placeholder values):

```sql
-- Create a document source entry
INSERT INTO document_sources (
    coach_id,
    title,
    source_type,
    metadata,
    process_status
) VALUES (
    'carnivore',  -- Change to: carnivore, fitness, mindfulness, etc.
    'Your PDF Title Here',
    'pdf',
    jsonb_build_object(
        'title', 'Your PDF Title',
        'author', 'Author Name',
        'access_tier', 'free',  -- or 'premium'
        'tags', ARRAY['carnivore', 'research', 'nutrition'],
        'upload_method', 'manual'
    ),
    'completed'
) RETURNING id;
```

**Important**: Copy the returned ID (looks like: `123e4567-e89b-12d3-a456-426614174000`)

### Step 3: Add PDF Content as Chunks
Break your PDF into logical sections (aim for 500-1000 characters each):

```sql
-- Insert document chunks
INSERT INTO coach_documents (
    coach_id,
    source_id,
    title,
    content,
    chunk_index,
    total_chunks,
    metadata,
    is_active
) VALUES 
(
    'carnivore',
    'PASTE-ID-FROM-STEP-2',  -- Use the ID from step 2
    'Section Title 1',
    'First 500-1000 characters of your PDF text here...',
    0,  -- First chunk is index 0
    3,  -- Total number of chunks you're creating
    '{"section": "introduction"}'::jsonb,
    true
),
(
    'carnivore',
    'PASTE-ID-FROM-STEP-2',
    'Section Title 2',
    'Next 500-1000 characters of your PDF text here...',
    1,  -- Second chunk is index 1
    3,
    '{"section": "main_content"}'::jsonb,
    true
),
(
    'carnivore',
    'PASTE-ID-FROM-STEP-2',
    'Section Title 3',
    'Final chunk of your PDF text here...',
    2,  -- Third chunk is index 2
    3,
    '{"section": "conclusion"}'::jsonb,
    true
);
```

### Step 4: Verify Upload
Check that your documents were added:

```sql
-- Check document sources
SELECT * FROM document_sources 
WHERE coach_id = 'carnivore' 
ORDER BY created_at DESC 
LIMIT 5;

-- Check document chunks
SELECT title, chunk_index, total_chunks, char_length(content) as content_length 
FROM coach_documents 
WHERE source_id = 'YOUR-SOURCE-ID'
ORDER BY chunk_index;
```

## Method 2: Bulk Upload Script (Coming Soon)

### Prerequisites
- Python 3.8+ installed
- PDF extraction library (PyPDF2 or similar)
- OpenAI API key for embeddings

### Upload Script Location
`/scripts/upload-pdf.py` (to be created)

## Method 3: Web Interface (Future)

A web-based upload interface is planned for the admin dashboard.

## Chunking Guidelines

### Optimal Chunk Size
- **Target**: 500-1000 characters per chunk
- **Maximum**: 1500 characters (to stay within token limits)
- **Overlap**: Consider 10-20% overlap between chunks for context

### How to Chunk Effectively
1. **By Section**: Break at natural section boundaries
2. **By Paragraph**: Keep related paragraphs together
3. **By Topic**: Group content by topic/concept

### Example Chunking Strategy
```
PDF: "The Carnivore Diet Guide" (10 pages)

Chunk 1: Introduction and Overview (chars 0-800)
Chunk 2: Benefits and Research (chars 700-1500)
Chunk 3: Implementation Steps (chars 1400-2200)
Chunk 4: Meal Planning (chars 2100-2900)
Chunk 5: Common Questions (chars 2800-3600)
```

## Adding Embeddings (Future Step)

Once OpenAI API is configured:

```sql
-- Update coach_documents with embeddings
UPDATE coach_documents 
SET embedding = (
    -- This will be generated by calling OpenAI API
    -- Placeholder for now
    NULL
)
WHERE source_id = 'YOUR-SOURCE-ID';
```

## Troubleshooting

### Common Issues

1. **Text Extraction from PDF**
   - Use online PDF to text converters
   - Or copy-paste from PDF reader
   - Clean up formatting issues

2. **Character Encoding**
   - Ensure UTF-8 encoding
   - Remove special characters that might break SQL

3. **Chunk Size Too Large**
   - Break into smaller chunks
   - Aim for natural paragraph breaks

## Quick Checklist

- [ ] PDF text extracted and ready
- [ ] Text broken into appropriate chunks
- [ ] Coach ID selected (carnivore, fitness, etc.)
- [ ] Access tier decided (free/premium)
- [ ] Tags identified for content
- [ ] Supabase SQL Editor open

## Example: Adding a Carnivore Research Paper

```sql
-- Step 1: Create source
INSERT INTO document_sources (
    coach_id, source_name, source_type, metadata, process_status
) VALUES (
    'carnivore',
    'Effects of Carnivore Diet on Inflammation - Smith et al 2023',
    'pdf',
    jsonb_build_object(
        'title', 'Effects of Carnivore Diet on Inflammation',
        'author', 'Smith, Jones, Williams',
        'year', 2023,
        'journal', 'Journal of Nutritional Science',
        'access_tier', 'premium',
        'tags', ARRAY['research', 'inflammation', 'carnivore', 'clinical trial']
    ),
    'completed'
) RETURNING id;

-- Returns: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'

-- Step 2: Add abstract as first chunk
INSERT INTO coach_documents (
    coach_id, source_id, title, content, chunk_index, total_chunks, metadata
) VALUES (
    'carnivore',
    'a1b2c3d4-e5f6-7890-abcd-ef1234567890',
    'Abstract',
    'This randomized controlled trial examined the effects of a carnivore diet on inflammatory markers in 120 participants over 6 months. Results showed significant reductions in CRP, IL-6, and TNF-Î± levels compared to control group...',
    0,
    5,
    '{"section": "abstract", "page": 1}'::jsonb
);
```

## Next Steps After Upload

1. **Test Retrieval**
   ```sql
   SELECT title, content 
   FROM coach_documents 
   WHERE coach_id = 'carnivore' 
   AND to_tsvector('english', content) @@ plainto_tsquery('english', 'inflammation');
   ```

2. **Add More PDFs**
   - Research papers
   - Diet guides
   - Recipe books
   - Clinical studies

3. **Configure OpenAI**
   - Get API key
   - Set up embedding generation
   - Update existing documents with embeddings

## Resources

- [Supabase SQL Editor](https://supabase.com/dashboard/project/ndthcblvtvquiaaekwpe/sql)
- [PDF to Text Converter](https://www.ilovepdf.com/pdf_to_text)
- [OpenAI Embeddings Guide](https://platform.openai.com/docs/guides/embeddings)